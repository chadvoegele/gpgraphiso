include common.mk

BMK2=~/src/bmk2

all: triangles/tuxedo-gtx1080.csv triangles/tuxedo-k80.csv triangles/tuxedo-gtx1080-power.csv ktruss/tuxedo-12.csv ktruss/tuxedo-24.csv ktruss/tuxedo-01.csv

# TODO: use make to generate rules below ...

triangles/tuxedo-gtx1080-raw.csv: $(wildcard gpu-logs/triangles/tuxedo-gtx1080/*.log)
	$(BMK2)/ps/log2csv.py -x tuxedo-gtx1080 $^ -o $@

triangles/tuxedo-gtx1080.csv: triangles/tuxedo-gtx1080-raw.csv
	$(BMK2)/ps/import.py -o $@ $^


triangles/tuxedo-gtx1080-power.map: $(wildcard gpu-logs/triangles/tuxedo-gtx1080-power/*.log)
	$(BMK2)/collect_multi.py -p3 $^ -m $@

triangles/tuxedo-gtx1080-power-energy-raw.csv: triangles/tuxedo-gtx1080-power.map
	scripts/extract_gpu_power.py $< -o $@

triangles/tuxedo-gtx1080-power-raw.csv: $(wildcard gpu-logs/triangles/tuxedo-gtx1080-power/*.log)
	$(BMK2)/ps/log2csv.py -x tuxedo-gtx1080-power $^ -o $@

triangles/tuxedo-gtx1080-power.csv: triangles/tuxedo-gtx1080-power-raw.csv triangles/tuxedo-gtx1080-power-energy-raw.csv
	$(BMK2)/ps/import.py -a energy_joules_1 -a energy_joules_2 -r triangles/tuxedo-gtx1080-power-energy-raw.csv -o $@ $<


triangles/tuxedo-k80-raw.csv: $(wildcard gpu-logs/triangles/tuxedo-k80/*.log)
	$(BMK2)/ps/log2csv.py -x tuxedo-k80 $^ -o $@

triangles/tuxedo-k80.csv: triangles/tuxedo-k80-raw.csv
	$(BMK2)/ps/import.py -o $@ $^

ktruss/tuxedo-12-raw.csv: $(wildcard cpu-logs/ktruss/tuxedo-12/*.log)
	$(BMK2)/ps/log2csv.py -x tuxedo-12 $^ -o $@

ktruss/tuxedo-12.csv: ktruss/tuxedo-12-raw.csv
	$(BMK2)/ps/import.py -o $@ $^

ktruss/tuxedo-01-raw.csv: $(wildcard cpu-logs/ktruss/tuxedo-01/*.log)
	$(BMK2)/ps/log2csv.py -x tuxedo-01 $^ -o $@

ktruss/tuxedo-01.csv: ktruss/tuxedo-01-raw.csv
	$(BMK2)/ps/import.py -o $@ $^

ktruss/tuxedo-24-raw.csv: $(wildcard cpu-logs/ktruss/tuxedo-24/*.log)
	$(BMK2)/ps/log2csv.py -x tuxedo-12 $^ -o $@

ktruss/tuxedo-24.csv: ktruss/tuxedo-24-raw.csv
	$(BMK2)/ps/import.py -o $@ $^


ktruss/tuxedo-gtx1080-raw.csv: $(wildcard gpu-logs/ktruss/tuxedo-gtx1080/*.log)
	$(BMK2)/ps/log2csv.py -x tuxedo-gtx1080 $^ -o $@

ktruss/tuxedo-gtx1080.csv: ktruss/tuxedo-gtx1080-raw.csv
	$(BMK2)/ps/import.py -o $@ $^
